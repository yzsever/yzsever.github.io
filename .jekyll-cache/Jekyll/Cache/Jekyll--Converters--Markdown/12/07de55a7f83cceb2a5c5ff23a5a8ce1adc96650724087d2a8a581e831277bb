I"<h2 id="问题背景">问题背景</h2>

<p>最近优化慢查询时，发现由于业务的变更，之前不常用的字段作为了查询条件，慢查询日志中的rows达到了18万行，因为没有索引，所以进行了全表扫描。顾采取策略为改查询字段添加索引。添加索引后，使用explain分析语句，显示会使用索引。</p>
<blockquote>
  <p>业务修改时，业务人员撰写新SQL后，一定要使用explain命令进行评估。</p>
</blockquote>

<p>索引上线后，过了一天再查看慢查询日志，发现该慢查询依然在列，依然全局扫描。</p>

<h2 id="问题分析">问题分析</h2>
<p>首先猜测一下可能是什么问题导致的：</p>
<ol>
  <li>索引没有上？ -&gt; 和运维人员确认后排除</li>
  <li>SQL语句中使用了IN语句，IN语句可能会使用不到索引？ -&gt; 发现了optimizer会先分析选择使用索引还是全表扫描</li>
</ol>

:ET