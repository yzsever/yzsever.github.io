I"}<blockquote>
  <p>ç¯å¢ƒä¸ºé˜¿é‡Œäº‘ CentOS Linux release 8.3.2011</p>
</blockquote>

<h3 id="redisçš„ä¸»ä»å¤åˆ¶">redisçš„ä¸»ä»å¤åˆ¶</h3>
<h4 id="1å®ç°æ ¸å¿ƒæ­¥éª¤">1ã€å®ç°æ ¸å¿ƒæ­¥éª¤</h4>
<p>redisçš„ä¸»ä»å¤åˆ¶å®ç°éå¸¸çš„ç®€å•ï¼Œæç®€çš„é£æ ¼, ä»èŠ‚ç‚¹æ‰§è¡Œ:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; SLAVEOF 127.0.0.1 6379
</code></pre></div></div>
<p>ä¹Ÿå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ã€‚</p>
<blockquote>
  <p>æ³¨æ„ï¼šä»èŠ‚ç‚¹åªè¯»ã€å¼‚æ­¥å¤åˆ¶ã€‚</p>
</blockquote>

<h4 id="2ä½¿ç”¨dockeræ­å»ºä¸»ä»çš„redisç¯å¢ƒ">2ã€ä½¿ç”¨dockeræ­å»ºä¸»ä»çš„redisç¯å¢ƒ</h4>
<p>æ ¹æ®ä¸ŠèŠ‚è¯¾è€å¸ˆæ¨èçš„rediså®‰è£…æ–¹å¼ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker run -p 6379:6379 --name redis01 -v /etc/redis/redis.conf:/etc/redis/redis.conf -v /etc/redis/data:/data -d redis redis-server /etc/redis/redis.conf --appendonly yes
</code></pre></div></div>
<p>è®©æˆ‘ä»¬æ¥è§£æä¸€ä¸‹è¿™æ¡å‘½ä»¤ï¼š</p>
<blockquote>
  <p>docker run [OPTIONS] IMAGE [COMMAND] [ARGâ€¦]</p>
  <ol>
    <li>docker run : åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œç„¶åå¯åŠ¨å®ƒ</li>
    <li>-p 6379:6379 : å‘å¸ƒå®¹å™¨çš„6379ç«¯å£åˆ°å®¿ä¸»æœºçš„6379ç«¯å£(å‰ä¸€ä¸ª6379)ã€‚</li>
    <li>â€“name redis01 : ä¸ºå®¹å™¨åˆ†é…ä¸€ä¸ªåç§°redis01</li>
    <li>-v /etc/redis/redis.conf:/etc/redis/redis.conf : -vå’Œé€‰é¡¹â€“volumeç›¸åŒï¼Œç»‘å®šæŒ‚è½½å·ï¼Œå°†ä¸»æœºçš„/etc/redis/redis.conf(å‰ä¸€ä¸ª)å®‰è£…åˆ°å®¹å™¨ä¸­çš„/etc/redis/redis.confã€‚</li>
    <li>-v /etc/redis/data:/data : å°†ä¸»æœºçš„/etc/redis/dataå®‰è£…åˆ°å®¹å™¨ä¸­çš„/data</li>
    <li>-d åŒé€‰é¡¹â€“detach åœ¨åå°è¿è¡Œå®¹å™¨å¹¶æ‰“å°å®¹å™¨ID</li>
    <li>redis ä½¿ç”¨çš„é•œè±¡åç§°(IMAGE)</li>
    <li>redis-server /etc/redis/redis.conf â€“appendonly yes: åœ¨å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„å‘½ä»¤:æŒ‡å®šé…ç½®æ–‡ä»¶å¯åŠ¨redis-serverè¿›ç¨‹ï¼Œå¼€å¯æ•°æ®æŒä¹…åŒ–</li>
  </ol>
</blockquote>

<p>ç†è§£å®Œæ•´æ¡å‘½ä»¤ä»¥åï¼Œæˆ‘ä»¬è‡ªç„¶å‘ç°å‡ ä¸ªé—®é¢˜ï¼š</p>
<ol>
  <li>ä¸»æœºä¸­çš„redis.confå¹¶æ²¡æœ‰</li>
  <li>/etc/redis/dataå½“å¤šä¸ªrediséœ€è¦åŒºåˆ†ç›®å½•</li>
</ol>

<h4 id="3é…ç½®redisconf">3ã€é…ç½®redis.conf</h4>
<p>è·å–redis.confçš„æ–¹å¼ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd ~
$ mkdir redis
$ cd redis
$ wget http://download.redis.io/redis-stable/redis.conf
$ cp redis.conf redis1.conf
$ cp redis.conf redis2.conf
</code></pre></div></div>

<p>ä¸‹è½½å¥½ç®¡ç½‘æä¾›çš„é…ç½®æ–‡ä»¶åï¼Œå¤åˆ¶ä¸¤ä»½å‡ºæ¥ä½œä¸ºä¸»ä»redisçš„é…ç½®æ–‡ä»¶ã€‚</p>

<p><strong>primaryé…ç½®</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># æ³¨é‡Šè¿™ä¸€è¡Œï¼Œè¡¨ç¤ºRediså¯ä»¥æ¥å—ä»»æ„ipçš„è¿æ¥
# bind 127.0.0.1 

# å½“å®¢æˆ·ç«¯éœ€è¦ä»å…¶ä»–hostè®¿é—®çš„æ—¶å€™ï¼Œéœ€è¦å…³é—­ä¿æŠ¤æ¨¡å¼
protected-mode no 

</code></pre></div></div>

<p><strong>replicaé…ç½®</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># æ³¨é‡Šè¿™ä¸€è¡Œï¼Œè¡¨ç¤ºRediså¯ä»¥æ¥å—ä»»æ„ipçš„è¿æ¥
# bind 127.0.0.1 

# å½“å®¢æˆ·ç«¯éœ€è¦ä»å…¶ä»–hostè®¿é—®çš„æ—¶å€™ï¼Œéœ€è¦å…³é—­ä¿æŠ¤æ¨¡å¼
protected-mode no 

</code></pre></div></div>

<p>è¿™é‡Œæˆ‘ä»¬ä¸»ä»redisçš„é…ç½®ä¸€è‡´ï¼Œå°†ä½¿ç”¨å‘½ä»¤SLAVEOFçš„æ–¹å¼å¼€å¯ä¸»ä»å¤åˆ¶ã€‚</p>

<h4 id="4åˆ›å»ºä¸»ä»rediså®¹å™¨å®ä¾‹">4ã€åˆ›å»ºä¸»ä»rediså®¹å™¨å®ä¾‹</h4>
<p><strong>primaryå®¹å™¨</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker run -p 6380:6379 --name redis1 -v /root/redis/redis1.conf:/etc/redis/redis.conf -v /etc/redis/data1:/data -d redis redis-server /etc/redis/redis.conf --appendonly yes
</code></pre></div></div>

<p><strong>replicaå®¹å™¨</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker run -p 6381:6379 --name redis2 -v /root/redis/redis2.conf:/etc/redis/redis.conf -v /etc/redis/data2:/data -d redis redis-server /etc/redis/redis.conf --appendonly yes
</code></pre></div></div>

<p>æŸ¥çœ‹ä¸€ä¸‹ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                               NAMES
145b5cf0be0e        redis               "docker-entrypoint.sâ€¦"   4 seconds ago       Up 3 seconds        0.0.0.0:6381-&gt;6379/tcp              redis2
4ff66c1b0f36        redis               "docker-entrypoint.sâ€¦"   38 seconds ago      Up 37 seconds       0.0.0.0:6380-&gt;6379/tcp              redis1
</code></pre></div></div>

<p>æŸ¥çœ‹ä¸»redisçš„å®¹å™¨IPï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker inspect 4ff | grep IPAddress
            "SecondaryIPAddresses": null,
            "IPAddress": "172.17.0.5",
                    "IPAddress": "172.17.0.5",

</code></pre></div></div>

<p>è¿›å…¥ä»rediså¼€å§‹ä¸»ä»å¤åˆ¶åŠŸèƒ½ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker exec -it 145 /bin/bash
redis2$ redis-cli
127.0.0.1:6379&gt; info
...
# Replication
role:master
connected_slaves:0
master_replid:32b30f3d7e5e1c8debe150fd7cf5d26d87385ae6
master_replid2:0000000000000000000000000000000000000000
...
127.0.0.1:6379&gt; slaveof 172.17.0.5 6379
OK
127.0.0.1:6379&gt; info
...
# Replication
role:slave
master_host:172.17.0.5
master_port:6379
master_link_status:up
master_last_io_seconds_ago:2
master_sync_in_progress:0
slave_repl_offset:28
slave_priority:100
slave_read_only:1
connected_slaves:0
...
</code></pre></div></div>

<h4 id="5ä¸»ä»å¤åˆ¶éªŒè¯">5ã€ä¸»ä»å¤åˆ¶éªŒè¯</h4>
<p>è¿›å…¥ä¸»redisï¼Œè®¾ç½®ä¸€äº›æ•°æ®ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker exec -it 4ff /bin/bash
redis1$ redis-cli
127.0.0.1:6379&gt; set key1 1
OK
127.0.0.1:6379&gt; set key2 2
OK
127.0.0.1:6379&gt; set key3 3
OK

</code></pre></div></div>

<p>è¿›å…¥ä»redisï¼ŒæŸ¥çœ‹åŒæ­¥æ•°æ®</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker exec -it 145 /bin/bash
redis1$ redis-cli
127.0.0.1:6379&gt; keys *
1) "key2"
2) "key3"
3) "key1"
127.0.0.1:6379&gt; get key1
"1"
</code></pre></div></div>

<h3 id="confé…ç½®çš„æ–¹å¼">confé…ç½®çš„æ–¹å¼</h3>
<p>ä¿®æ”¹redis2.conf</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#replicaof &lt;masterip&gt; &lt;masterport&gt;
replicaof 172.17.0.5 6379
</code></pre></div></div>

<h3 id="å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£</h3>
<ol>
  <li>https://www.cnblogs.com/fan-gx/p/11463400.html</li>
  <li><a href="https://docs.docker.com/engine/reference/commandline/run/#options">docker runä½¿ç”¨æ‰‹å†Œ</a></li>
</ol>

:ET