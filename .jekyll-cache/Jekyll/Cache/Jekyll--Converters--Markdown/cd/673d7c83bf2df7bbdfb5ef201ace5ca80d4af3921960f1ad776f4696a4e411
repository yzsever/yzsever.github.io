I"˜<h2 id="ä¸€é˜¿é‡Œäº‘å’Œdockeræ­å»ºä¸»ä»æœåŠ¡å™¨">ä¸€ã€é˜¿é‡Œäº‘å’ŒDockeræ­å»ºä¸»ä»æœåŠ¡å™¨</h2>
<p>1ã€é˜¿é‡Œäº‘ç¯å¢ƒä¸ºcentosï¼Œé¦–å…ˆå®‰è£…docker</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# yum install docker-ce-3:19.03.13-3.el8 -y
</code></pre></div></div>

<p>2ã€ç„¶åæ‹‰å–dockeré•œåƒï¼Œè¿™é‡Œä½¿ç”¨5.7ç‰ˆæœ¬çš„mysqlï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# docker pull mysql:5.7
</code></pre></div></div>

<p>3ã€ä½¿ç”¨æ­¤é•œåƒå¯åŠ¨å®¹å™¨ï¼Œè¿™é‡Œéœ€è¦åˆ†åˆ«å¯åŠ¨ä¸»ä»ä¸¤ä¸ªå®¹å™¨</p>

<p>Master(ä¸»)ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# docker run -p 3309:3306 --name primary -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7
</code></pre></div></div>

<p>Slave(ä»)ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# docker run -p 3308:3306 --name secondary -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7
</code></pre></div></div>
<p>primaryå¯¹å¤–æ˜ å°„çš„ç«¯å£æ˜¯3309ï¼Œsecondaryå¯¹å¤–æ˜ å°„çš„ç«¯å£æ˜¯3308ã€‚ä½¿ç”¨docker pså‘½ä»¤æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                               NAMES
c2e509a41b29        mysql:5.7           "docker-entrypoint.sâ€¦"   3 weeks ago         Up 2 weeks          33060/tcp, 0.0.0.0:3308-&gt;3306/tcp   secondary
ec4a868c061d        mysql:5.7           "docker-entrypoint.sâ€¦"   3 weeks ago         Up 2 weeks          33060/tcp, 0.0.0.0:3309-&gt;3306/tcp   primary
</code></pre></div></div>
<p>4ã€å®¹å™¨ä¸­Mysqlæµ‹è¯•ï¼šä½¿ç”¨ä¸»å®¿ä¸»æœºIP:3309,å’Œä¸»å®¿ä¸»æœºIP:3308è¿æ¥Mysqlï¼Œèƒ½å¤Ÿè¿é€šåˆ™ç¬¬ä¸€æ­¥æˆåŠŸã€‚</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# mysql -h ä¸»å®¿ä¸»æœºIP -P 3309 -uroot -p123456 
</code></pre></div></div>

<blockquote>
  <p>é˜¿é‡Œäº‘éœ€è¦é…ç½®æš´éœ²ç«¯å£è§„åˆ™æš´éœ²3308å’Œ3309ç«¯å£</p>
</blockquote>

<h2 id="äºŒé…ç½®ä¸»æ•°æ®åº“primary">äºŒã€é…ç½®ä¸»æ•°æ®åº“(primary)</h2>
<p>1ã€è¿›å…¥åˆ°primaryå®¹å™¨å†…éƒ¨ï¼Œä¿®æ”¹mysqlçš„é…ç½®æ–‡ä»¶my.cnfï¼Œé…ç½®server-idã€‚</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# docker exec -it ec4 /bin/bash
root@ec4a868c061d:/# apt-get update
root@ec4a868c061d:/# apt-get install vim
root@ec4a868c061d:/# cd /etc/mysql
root@ec4a868c061d:/# vim my.cnf
</code></pre></div></div>
<p>my.cnfçš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[mysqld]
## åŒä¸€å±€åŸŸç½‘å†…æ³¨æ„è¦å”¯ä¸€
server-id=100  
## å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—åŠŸèƒ½ï¼Œå¯ä»¥éšä¾¿å–ï¼ˆå…³é”®ï¼‰
log-bin=mysql-bin
</code></pre></div></div>
<p>é…ç½®å®Œæˆä¹‹åï¼Œéœ€è¦é‡å¯mysqlæœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆã€‚</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@ec4a868c061d:/# service mysql restart
~# docker start ec4
</code></pre></div></div>

<p>2ã€åœ¨primaryæ•°æ®åº“åˆ›å»ºæ•°æ®åŒæ­¥ç”¨æˆ·ï¼Œæˆäºˆç”¨æˆ·slave REPLICATION SLAVEæƒé™å’ŒREPLICATION CLIENTæƒé™ï¼Œç”¨äºåœ¨ä¸»ä»åº“ä¹‹é—´åŒæ­¥æ•°æ®ã€‚</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@ec4a868c061d:/# mysql -uroot -p123456
mysql&gt; flush privileges; 
mysql&gt; CREATE USER 'secondary'@'%' IDENTIFIED BY '123456';
mysql&gt; GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO 'secondary'@'%';
</code></pre></div></div>
<blockquote>
  <p>(åˆ›å»ºç”¨æˆ·å‰å…ˆåˆ·æ–°ä¸€ä¸‹æƒé™ï¼Œä¸ç„¶å¯èƒ½æŠ¥é”™ã€‚å‚è€ƒï¼šhttps://blog.csdn.net/u011575570/article/details/51438841)</p>
</blockquote>

<h2 id="ä¸‰é…ç½®ä»æ•°æ®åº“secondary">ä¸‰ã€é…ç½®ä»æ•°æ®åº“(secondary)</h2>

<p>å’Œé…ç½®ä¸»æ•°æ®åº“ä¸€æ ·ï¼Œé…ç½®æ–‡ä»¶my.cnfä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[mysqld]
## è®¾ç½®server_id,æ³¨æ„è¦å”¯ä¸€
server-id=101  
## å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—åŠŸèƒ½ï¼Œä»¥å¤‡Slaveä½œä¸ºå…¶å®ƒSlaveçš„Masteræ—¶ä½¿ç”¨
log-bin=mysql-slave-bin   
## relay_logé…ç½®ä¸­ç»§æ—¥å¿—
relay_log=edu-mysql-relay-bin
</code></pre></div></div>

<p>é…ç½®å®Œæˆåä¹Ÿéœ€è¦é‡å¯mysqlæœåŠ¡å’Œdockerå®¹å™¨ã€‚</p>

<h2 id="å››å¼€å¯ä¸»ä»å¤åˆ¶">å››ã€å¼€å¯ä¸»ä»å¤åˆ¶</h2>
<p>1ã€åœ¨Primaryè¿›å…¥mysqlï¼Œæ‰§è¡Œshow master status;</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; show master status;
+------------------+----------+--------------+------------------+-------------------+
| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
+------------------+----------+--------------+------------------+-------------------+
| mysql-bin.000007 |     4638 |              |                  |                   |
+------------------+----------+--------------+------------------+-------------------+
1 row in set (0.00 sec)
</code></pre></div></div>
<p>Fileå’ŒPositionå­—æ®µçš„å€¼åé¢å°†ä¼šç”¨åˆ°ï¼Œåœ¨åé¢çš„æ“ä½œå®Œæˆä¹‹å‰ï¼Œéœ€è¦ä¿è¯Masteråº“ä¸èƒ½åšä»»ä½•æ“ä½œï¼Œå¦åˆ™å°†ä¼šå¼•èµ·çŠ¶æ€å˜åŒ–ï¼ŒFileå’ŒPositionå­—æ®µçš„å€¼å˜åŒ–ã€‚</p>

<p>2ã€æŸ¥çœ‹Primaryå®¹å™¨çš„IPåœ°å€</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~# docker inspect --format='' ec4

</code></pre></div></div>

<p>2ã€åœ¨Slave ä¸­è¿›å…¥ mysql</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; change master to master_host='172.17.0.2', master_user='secondary', master_password='123456', master_port=3306, master_log_file='mysql-bin.000007', master_log_pos= 4638, master_connect_retry=30;

</code></pre></div></div>

<p>å‘½ä»¤è¯´æ˜ï¼š</p>

<table>
  <tbody>
    <tr>
      <td>master_host ï¼šMasterçš„åœ°å€ï¼ŒæŒ‡çš„æ˜¯å®¹å™¨çš„ç‹¬ç«‹ip,å¯ä»¥é€šè¿‡docker inspect â€“format=â€™â€™ å®¹å™¨åç§°</td>
      <td>å®¹å™¨idæŸ¥è¯¢å®¹å™¨çš„ip</td>
    </tr>
  </tbody>
</table>

<h2 id="äº”èŠ±å¼æ‰å‘">äº”ã€èŠ±å¼æ‰å‘</h2>

<h2 id="å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£</h2>
<ol>
  <li><a href="https://www.cnblogs.com/linjiaxin/p/12761296.html">åŸºäºDockerçš„Mysqlä¸»ä»å¤åˆ¶æ­å»º</a></li>
</ol>
:ET